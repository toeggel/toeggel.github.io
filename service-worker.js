var baseApiUrl = "https://mawewebapi.azurewebsites.net/api"; // https://mawewebapi.azurewebsites.net/api", "http://localhost:22603/api"
var version = 13;
var dataCache = "dataCache-1";
var appShellCache = "appShellCache-" + version;
var custom404 = new Request("/404.html");
var routesToRedirects = [
    // Use this configuration instead of the cached "home". It's needed for the github SPA pages hack
    new Request("/home"),
    new Request("/camera"),
    new Request("/pushNotification"),
];
var filesToCache = [
    // new Request("/home"),
    // new Request("/camera"),
    // new Request("/pushNotification"),
    new Request("/main.js"),
    // App
    new Request("/"),
    new Request("/app.min.js"),
    new Request("/app/app.component.html "),
    new Request("/app/home.component.html "),
    new Request("/app/message.component.html "),
    new Request("/app/push-notification.component.html "),
    new Request("/app/camera.component.html "),
    new Request("/app/snackbar.component.html"),
    new Request("/app/snackbar.component.css"),
    new Request("/assets/css/main.css"),
    new Request("/assets/images/surfer-48.png"),
    new Request("/assets/images/surfer-1.jpg"),
    new Request("/manifest.json"),
    new Request("/systemjs.config.js"),
    // Vendor
    new Request("/vendor/core-js/client/shim.min.js"),
    new Request("/vendor/zone.js/dist/zone.js"),
    new Request("/vendor/reflect-metadata/Reflect.js"),
    new Request("/vendor/systemjs/dist/system.src.js"),
    // External
    new Request("https://fonts.googleapis.com/icon?family=Material+Icons"),
    new Request("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css"),
    new Request("https://code.jquery.com/jquery-3.1.0.min.js"),
    new Request("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"),
];
// If a byte changes -> new service worker will be installed
self.addEventListener("install", function (e) {
    console.log("[ServiceWorker] Install");
    e.waitUntil(caches.open(appShellCache).then(function (cache) {
        console.log("[ServiceWorker] Caching App Shell");
        return cache.addAll(filesToCache)
            .then(function () { handle404Redirects(cache); });
    }).then(function () {
        console.log("[ServiceWorker] Skip waiting on install");
        return skipWaiting();
    }));
});
// When the currently open pages of your site are closed, the old service worker will be killed 
// and the new service worker will take control and fires "activate"
self.addEventListener("activate", function (e) {
    console.log("[ServiceWorker] Activate");
    e.waitUntil(caches.keys().then(function (keyList) {
        return Promise.all(keyList.map(function (key) {
            if (key !== appShellCache) {
                console.log("[ServiceWorker] Removing old cache", key);
                return caches.delete(key);
            }
        })).then(function () {
            console.log("[ServiceWorker] Claiming clients for version ", version);
            return clients.claim();
        });
    }));
});
self.addEventListener("fetch", function (e) {
    var dataUrl = baseApiUrl + "/messages";
    // we cache the data received from the data api so that we can display the data really fast before receiving the data
    if (e.request.url.indexOf(dataUrl) > -1) {
        // CORS-Shit: when offline the fetch fails hard because of cors! As a workaround I just return the cached data when offline.
        if (navigator.onLine) {
            e.respondWith(fetch(e.request)
                .then(function (response) {
                return caches.open(dataCache).then(function (cache) {
                    cache.put(e.request, response.clone());
                    console.log("[ServiceWorker] Fetched&Cached Data");
                    return response;
                });
            }));
        }
        else {
            e.respondWith(caches.match(e.request).then(function (response) {
                return response;
            }));
        }
    }
    else {
        // return the cached app shell
        e.respondWith(caches.match(e.request).then(function (response) {
            return response || fetch(e.request);
        }));
    }
});
self.addEventListener("push", function (e) {
    console.log("[ServiceWorker] Push message received ", e);
    e.waitUntil(fetch(baseApiUrl + "/notification/message")
        .then(function (response) { return response.json(); })
        .then(function (notification) {
        var notificationTitle = notification.title || "Notification";
        var notificationMessage = notification.message || "Click Me!";
        registration.showNotification(notificationTitle, {
            body: notificationMessage,
            icon: "assets/images/surfer-48.png",
            tag: "message-tag",
            vibrate: [200, 100, 200, 100, 200, 100, 400],
            actions: [
                { "action": "yes", "title": "Yes", "icon": "images/yes.png" },
                { "action": "no", "title": "No", "icon": "images/no.png" },
            ],
        });
    }));
});
self.addEventListener("notificationclick", function (event) {
    console.log("[ServiceWorker] Notification click: tag ", event.notification.tag);
    event.notification.close();
    var url = "https://toeggel.github.io";
    event.waitUntil(clients.matchAll({
        type: "window",
    })
        .then(function (windowClients) {
        for (var i = 0; i < windowClients.length; i++) {
            var client = windowClients[i];
            console.log("[ServiceWorker] Client URL:", client.url);
            if (client.url === url && "focus" in client) {
                return client.focus();
            }
        }
        if (clients.openWindow) {
            return clients.openWindow(url);
        }
    }));
});
function handle404Redirects(cache) {
    return fetch(custom404)
        .then(function (response) {
        routesToRedirects.forEach(function (route) {
            var r = response.clone();
            return cache.put(route, r);
        });
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsaWVudC9zZXJ2aWNlLXdvcmtlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLFVBQVUsR0FBRywwQ0FBMEMsQ0FBQSxDQUFDLDBFQUEwRTtBQUV0SSxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDakIsSUFBSSxTQUFTLEdBQUcsYUFBYSxDQUFDO0FBQzlCLElBQUksYUFBYSxHQUFHLG1CQUFpQixPQUFTLENBQUM7QUFFL0MsSUFBTSxTQUFTLEdBQUcsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDM0MsSUFBTSxpQkFBaUIsR0FBRztJQUN4QixpR0FBaUc7SUFDakcsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDO0lBQ3BCLElBQUksT0FBTyxDQUFDLFNBQVMsQ0FBQztJQUN0QixJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztDQUNqQyxDQUFDO0FBQ0YsSUFBSSxZQUFZLEdBQWM7SUFDNUIsd0JBQXdCO0lBQ3hCLDBCQUEwQjtJQUMxQixvQ0FBb0M7SUFFcEMsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDO0lBRXZCLE1BQU07SUFDTixJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUM7SUFDaEIsSUFBSSxPQUFPLENBQUMsYUFBYSxDQUFDO0lBQzFCLElBQUksT0FBTyxDQUFDLDBCQUEwQixDQUFDO0lBQ3ZDLElBQUksT0FBTyxDQUFDLDJCQUEyQixDQUFDO0lBQ3hDLElBQUksT0FBTyxDQUFDLDhCQUE4QixDQUFDO0lBQzNDLElBQUksT0FBTyxDQUFDLHdDQUF3QyxDQUFDO0lBQ3JELElBQUksT0FBTyxDQUFDLDZCQUE2QixDQUFDO0lBQzFDLElBQUksT0FBTyxDQUFDLDhCQUE4QixDQUFDO0lBQzNDLElBQUksT0FBTyxDQUFDLDZCQUE2QixDQUFDO0lBQzFDLElBQUksT0FBTyxDQUFDLHNCQUFzQixDQUFDO0lBQ25DLElBQUksT0FBTyxDQUFDLDhCQUE4QixDQUFDO0lBQzNDLElBQUksT0FBTyxDQUFDLDZCQUE2QixD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QUFhO1FBQzNCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzlDLElBQUksTUFBTSxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLDZCQUE2QixFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2RCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxLQUFLLEdBQUcsSUFBSSxPQUFPLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDNUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN4QixDQUFDO1FBQ0gsQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FDTCxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSCw0QkFBNEIsS0FBSztJQUMvQixNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztTQUNwQixJQUFJLENBQUMsVUFBQSxRQUFRO1FBQ1osaUJBQWlCLENBQUMsT0FBTyxDQUFDLFVBQUEsS0FBSztZQUM3QixJQUFJLENBQUMsR0FBRyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDekIsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDIiwiZmlsZSI6ImNsaWVudC9zZXJ2aWNlLXdvcmtlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCBiYXNlQXBpVXJsID0gXCJodHRwczovL21hd2V3ZWJhcGkuYXp1cmV3ZWJzaXRlcy5uZXQvYXBpXCIgLy8gaHR0cHM6Ly9tYXdld2ViYXBpLmF6dXJld2Vic2l0ZXMubmV0L2FwaVwiLCBcImh0dHA6Ly9sb2NhbGhvc3Q6MjI2MDMvYXBpXCJcblxubGV0IHZlcnNpb24gPSAxMjtcbmxldCBkYXRhQ2FjaGUgPSBcImRhdGFDYWNoZS0xXCI7XG5sZXQgYXBwU2hlbGxDYWNoZSA9IGBhcHBTaGVsbENhY2hlLSR7dmVyc2lvbn1gO1xuXG5jb25zdCBjdXN0b200MDQgPSBuZXcgUmVxdWVzdChcIi80MDQuaHRtbFwiKTtcbmNvbnN0IHJvdXRlc1RvUmVkaXJlY3RzID0gW1xuICAvLyBVc2UgdGhpcyBjb25maWd1cmF0aW9uIGluc3RlYWQgb2YgdGhlIGNhY2hlZCBcImhvbWVcIi4gSXQncyBuZWVkZWQgZm9yIHRoZSBnaXRodWIgU1BBIHBhZ2VzIGhhY2tcbiAgbmV3IFJlcXVlc3QoXCIvaG9tZVwiKSxcbiAgbmV3IFJlcXVlc3QoXCIvY2FtZXJhXCIpLFxuICBuZXcgUmVxdWVzdChcIi9wdXNoTm90aWZpY2F0aW9uXCIpLFxuXTtcbmxldCBmaWxlc1RvQ2FjaGU6IFJlcXVlc3RbXSA9IFtcbiAgLy8gbmV3IFJlcXVlc3QoXCIvaG9tZVwiKSxcbiAgLy8gbmV3IFJlcXVlc3QoXCIvY2FtZXJhXCIpLFxuICAvLyBuZXcgUmVxdWVzdChcIi9wdXNoTm90aWZpY2F0aW9uXCIpLFxuXG4gIG5ldyBSZXF1ZXN0KFwiL21haW4uanNcIiksXG5cbiAgLy8gQXBwXG4gIG5ldyBSZXF1ZXN0KFwiL1wiKSxcbiAgbmV3IFJlcXVlc3QoXCIvYXBwLm1pbi5qc1wiKSxcbiAgbmV3IFJlcXVlc3QoXCIvYXBwL2FwcC5jb21wb25lbnQuaHRtbCBcIiksXG4gIG5ldyBSZXF1ZXN0KFwiL2FwcC9ob21lLmNvbXBvbmVudC5odG1sIFwiKSxcbiAgbmV3IFJlcXVlc3QoXCIvYXBwL21lc3NhZ2UuY29tcG9uZW50Lmh0bWwgXCIpLFxuICBuZXcgUmVxdWVzdChcIi9hcHAvcHVzaC1ub3RpZmljYXRpb24uY29tcG9uZW50Lmh0bWwgXCIpLFxuICBuZXcgUmVxdWVzdChcIi9hcHAvY2FtZXJhLmNvbXBvbmVudC5odG1sIFwiKSxcbiAgbmV3IFJlcXVlc3QoXCIvYXBwL3NuYWNrYmFyLmNvbXBvbmVudC5odG1sXCIpLFxuICBuZXcgUmVxdWVzdChcIi9hcHAvc25hY2tiYXIuY29tcG9uZW50LmNzc1wiKSxcbiAgbmV3IFJlcXVlc3QoXCIvYXNzZXRzL2Nzcy9tYWluLmNzc1wiKSxcbiAgbmV3IFJlcXVlc3QoXCIvYXNzZXRzL2ltYWdlcy9zdXJmZXItNDgucG5nXCIpLFxuICBuZXcgUmVxdWVzdChcIi9hc3NldHMvaW1hZ2VzL3N1cmZlci0xLmpwZ1wiKSxcbiAgbmV3IFJlcXVlc3QoXCIvbWFuaWZlc3QuanNvblwiKSxcbiAgbmV3IFJlcXVlc3QoXCIvc3lzdGVtanMuY29uZmlnLmpzXCIpLFxuXG4gIC8vIFZlbmRvclxuICBuZXcgUmVxdWVzdChcIi92ZW5kb3IvY29yZS1qcy9jbGllbnQvc2hpbS5taW4uanNcIiksXG4gIG5ldyBSZXF1ZXN0KFwiL3ZlbmRvci96b25lLmpzL2Rpc3Qvem9uZS5qc1wiKSxcbiAgbmV3IFJlcXVlc3QoXCIvdmVuZG9yL3JlZmxlY3QtbWV0YWRhdGEvUmVmbGVjdC5qc1wiKSxcbiAgbmV3IFJlcXVlc3QoXCIvdmVuZG9yL3N5c3RlbWpzL2Rpc3Qvc3lzdGVtLnNyYy5qc1wiKSxcblxuICAvLyBFeHRlcm5hbFxuICBuZXcgUmVxdWVzdChcImh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vaWNvbj9mYW1pbHk9TWF0ZXJpYWwrSWNvbnNcIiksXG4gIG5ldyBSZXF1ZXN0KFwiaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbWF0ZXJpYWxpemUvMC45OC4wL2Nzcy9tYXRlcmlhbGl6ZS5taW4uY3NzXCIpLFxuICBuZXcgUmVxdWVzdChcImh0dHBzOi8vY29kZS5qcXVlcnkuY29tL2pxdWVyeS0zLjEuMC5taW4uanNcIiksXG4gIG5ldyBSZXF1ZXN0KFwiaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbWF0ZXJpYWxpemUvMC45OC4wL2pzL21hdGVyaWFsaXplLm1pbi5qc1wiKSxcbl07XG5cbi8vIElmIGEgYnl0ZSBjaGFuZ2VzIC0+IG5ldyBzZXJ2aWNlIHdvcmtlciB3aWxsIGJlIGluc3RhbGxlZFxuc2VsZi5hZGRFdmVudExpc3RlbmVyKFwiaW5zdGFsbFwiLCAoZTogRXh0ZW5kYWJsZUV2ZW50KSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiW1NlcnZpY2VXb3JrZXJdIEluc3RhbGxcIik7XG5cbiAgZS53YWl0VW50aWwoXG4gICAgY2FjaGVzLm9wZW4oYXBwU2hlbGxDYWNoZSkudGhlbihmdW5jdGlvbiAoY2FjaGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiW1NlcnZpY2VXb3JrZXJdIENhY2hpbmcgQXBwIFNoZWxsXCIpO1xuICAgICAgcmV0dXJuIGNhY2hlLmFkZEFsbChmaWxlc1RvQ2FjaGUpXG4gICAgICAgIC50aGVuKCgpID0+IHsgaGFuZGxlNDA0UmVkaXJlY3RzKGNhY2hlKTsgfSk7XG4gICAgfSkudGhlbigoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIltTZXJ2aWNlV29ya2VyXSBTa2lwIHdhaXRpbmcgb24gaW5zdGFsbFwiKTtcbiAgICAgIHJldHVybiBza2lwV2FpdGluZygpO1xuICAgIH0pXG4gICk7XG59KTtcblxuLy8gV2hlbiB0aGUgY3VycmVudGx5IG9wZW4gcGFnZXMgb2YgeW91ciBzaXRlIGFyZSBjbG9zZWQsIHRoZSBvbGQgc2VydmljZSB3b3JrZXIgd2lsbCBiZSBraWxsZWQgXG4vLyBhbmQgdGhlIG5ldyBzZXJ2aWNlIHdvcmtlciB3aWxsIHRha2UgY29udHJvbCBhbmQgZmlyZXMgXCJhY3RpdmF0ZVwiXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoXCJhY3RpdmF0ZVwiLCAoZTogRXh0ZW5kYWJsZUV2ZW50KSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiW1NlcnZpY2VXb3JrZXJdIEFjdGl2YXRlXCIpO1xuICBlLndhaXRVbnRpbChcbiAgICBjYWNoZXMua2V5cygpLnRoZW4oKGtleUxpc3QpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChrZXlMaXN0Lm1hcCgoa2V5KSA9PiB7XG4gICAgICAgIGlmIChrZXkgIT09IGFwcFNoZWxsQ2FjaGUpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIltTZXJ2aWNlV29ya2VyXSBSZW1vdmluZyBvbGQgY2FjaGVcIiwga2V5KTtcbiAgICAgICAgICByZXR1cm4gY2FjaGVzLmRlbGV0ZShrZXkpO1xuICAgICAgICB9XG4gICAgICB9KSkudGhlbigoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiW1NlcnZpY2VXb3JrZXJdIENsYWltaW5nIGNsaWVudHMgZm9yIHZlcnNpb24gXCIsIHZlcnNpb24pO1xuICAgICAgICByZXR1cm4gY2xpZW50cy5jbGFpbSgpO1xuICAgICAgfSk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoXCJmZXRjaFwiLCAoZTogRmV0Y2hFdmVudCkgPT4ge1xuICBsZXQgZGF0YVVybCA9IGAke2Jhc2VBcGlVcmx9L21lc3NhZ2VzYDtcbiAgLy8gd2UgY2FjaGUgdGhlIGRhdGEgcmVjZWl2ZWQgZnJvbSB0aGUgZGF0YSBhcGkgc28gdGhhdCB3ZSBjYW4gZGlzcGxheSB0aGUgZGF0YSByZWFsbHkgZmFzdCBiZWZvcmUgcmVjZWl2aW5nIHRoZSBkYXRhXG4gIGlmIChlLnJlcXVlc3QudXJsLmluZGV4T2YoZGF0YVVybCkgPiAtMSkge1xuICAgIC8vIENPUlMtU2hpdDogd2hlbiBvZmZsaW5lIHRoZSBmZXRjaCBmYWlscyBoYXJkIGJlY2F1c2Ugb2YgY29ycyEgQXMgYSB3b3JrYXJvdW5kIEkganVzdCByZXR1cm4gdGhlIGNhY2hlZCBkYXRhIHdoZW4gb2ZmbGluZS5cbiAgICBpZiAobmF2aWdhdG9yLm9uTGluZSkge1xuICAgICAgZS5yZXNwb25kV2l0aChcbiAgICAgICAgZmV0Y2goZS5yZXF1ZXN0KVxuICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlcy5vcGVuKGRhdGFDYWNoZSkudGhlbigoY2FjaGUpID0+IHtcbiAgICAgICAgICAgICAgY2FjaGUucHV0KGUucmVxdWVzdCwgcmVzcG9uc2UuY2xvbmUoKSk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiW1NlcnZpY2VXb3JrZXJdIEZldGNoZWQmQ2FjaGVkIERhdGFcIik7XG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBlLnJlc3BvbmRXaXRoKFxuICAgICAgICBjYWNoZXMubWF0Y2goZS5yZXF1ZXN0KS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyByZXR1cm4gdGhlIGNhY2hlZCBhcHAgc2hlbGxcbiAgICBlLnJlc3BvbmRXaXRoKFxuICAgICAgY2FjaGVzLm1hdGNoKGUucmVxdWVzdCkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8IGZldGNoKGUucmVxdWVzdCk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoXCJwdXNoXCIsIChlOiBQdXNoRXZlbnQpID0+IHtcbiAgY29uc29sZS5sb2coXCJbU2VydmljZVdvcmtlcl0gUHVzaCBtZXNzYWdlIHJlY2VpdmVkIFwiLCBlKTtcbiAgZS53YWl0VW50aWwoXG4gICAgZmV0Y2goYCR7YmFzZUFwaVVybH0vbm90aWZpY2F0aW9uL21lc3NhZ2VgKVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4geyByZXR1cm4gcmVzcG9uc2UuanNvbigpOyB9KVxuICAgICAgLnRoZW4obm90aWZpY2F0aW9uID0+IHtcbiAgICAgICAgbGV0IG5vdGlmaWNhdGlvblRpdGxlID0gbm90aWZpY2F0aW9uLnRpdGxlIHx8IFwiTm90aWZpY2F0aW9uXCI7XG4gICAgICAgIGxldCBub3RpZmljYXRpb25NZXNzYWdlID0gbm90aWZpY2F0aW9uLm1lc3NhZ2UgfHwgXCJDbGljayBNZSFcIjtcbiAgICAgICAgcmVnaXN0cmF0aW9uLnNob3dOb3RpZmljYXRpb24obm90aWZpY2F0aW9uVGl0bGUsIHtcbiAgICAgICAgICBib2R5OiBub3RpZmljYXRpb25NZXNzYWdlLFxuICAgICAgICAgIGljb246IFwiYXNzZXRzL2ltYWdlcy9zdXJmZXItNDgucG5nXCIsXG4gICAgICAgICAgdGFnOiBcIm1lc3NhZ2UtdGFnXCIsXG4gICAgICAgICAgdmlicmF0ZTogWzIwMCwgMTAwLCAyMDAsIDEwMCwgMjAwLCAxMDAsIDQwMF0sXG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgeyBcImFjdGlvblwiOiBcInllc1wiLCBcInRpdGxlXCI6IFwiWWVzXCIsIFwiaWNvblwiOiBcImltYWdlcy95ZXMucG5nXCIgfSxcbiAgICAgICAgICAgIHsgXCJhY3Rpb25cIjogXCJub1wiLCBcInRpdGxlXCI6IFwiTm9cIiwgXCJpY29uXCI6IFwiaW1hZ2VzL25vLnBuZ1wiIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSBhcyBhbnkpO1xuICAgICAgfSkpO1xufSk7XG5cbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcihcIm5vdGlmaWNhdGlvbmNsaWNrXCIsIChldmVudDogTm90aWZpY2F0aW9uRXZlbnQpID0+IHtcbiAgY29uc29sZS5sb2coXCJbU2VydmljZVdvcmtlcl0gTm90aWZpY2F0aW9uIGNsaWNrOiB0YWcgXCIsIGV2ZW50Lm5vdGlmaWNhdGlvbi50YWcpO1xuICBldmVudC5ub3RpZmljYXRpb24uY2xvc2UoKTtcbiAgbGV0IHVybCA9IFwiaHR0cHM6Ly90b2VnZ2VsLmdpdGh1Yi5pb1wiO1xuICBldmVudC53YWl0VW50aWwoXG4gICAgY2xpZW50cy5tYXRjaEFsbCh7XG4gICAgICB0eXBlOiBcIndpbmRvd1wiLFxuICAgIH0pXG4gICAgICAudGhlbihmdW5jdGlvbiAod2luZG93Q2xpZW50cykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdpbmRvd0NsaWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBsZXQgY2xpZW50ID0gd2luZG93Q2xpZW50c1tpXTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIltTZXJ2aWNlV29ya2VyXSBDbGllbnQgVVJMOlwiLCBjbGllbnQudXJsKTtcbiAgICAgICAgICBpZiAoY2xpZW50LnVybCA9PT0gdXJsICYmIFwiZm9jdXNcIiBpbiBjbGllbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBjbGllbnQuZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsaWVudHMub3BlbldpbmRvdykge1xuICAgICAgICAgIHJldHVybiBjbGllbnRzLm9wZW5XaW5kb3codXJsKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgKTtcbn0pO1xuXG5mdW5jdGlvbiBoYW5kbGU0MDRSZWRpcmVjdHMoY2FjaGUpIHtcbiAgcmV0dXJuIGZldGNoKGN1c3RvbTQwNClcbiAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICByb3V0ZXNUb1JlZGlyZWN0cy5mb3JFYWNoKHJvdXRlID0+IHtcbiAgICAgICAgbGV0IHIgPSByZXNwb25zZS5jbG9uZSgpO1xuICAgICAgICByZXR1cm4gY2FjaGUucHV0KHJvdXRlLCByKTtcbiAgICAgIH0pO1xuICAgIH0pO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
